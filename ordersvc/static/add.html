<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</title>
<style>
:root {
  --main-color: #68b684;
  --main-color-hover: #5ba378;
  --bg-color: #f6f8f7;
  --radius: 12px;
  --transition: 0.3s ease;
}
body {
  font-family: "Segoe UI", "Roboto", sans-serif;
  background: var(--bg-color);
  color: #222;
  margin: 0;
  padding: 0;
}
header {
  background: var(--main-color);
  color: white;
  text-align: center;
  padding: 25px 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}
header h1 {
  margin: 0;
  font-size: 26px;
}
.container {
  max-width: 700px;
  margin: 40px auto;
  background: #fff;
  border-radius: var(--radius);
  box-shadow: 0 4px 14px rgba(0,0,0,0.08);
  padding: 30px 40px;
  animation: fadeIn 0.4s ease;
}
h2, h3 {
  color: #333;
  border-left: 4px solid var(--main-color);
  padding-left: 10px;
  margin-top: 25px;
}
label {
  display: block;
  margin-top: 12px;
  font-weight: 500;
}
input {
  width: 100%;
  border: 1px solid #ccc;
  border-radius: var(--radius);
  padding: 10px 12px;
  margin-top: 5px;
  box-sizing: border-box;
  font-size: 14px;
  transition: var(--transition);
}
input:focus {
  border-color: var(--main-color);
  box-shadow: 0 0 5px rgba(104,182,132,0.4);
}
button {
  margin-top: 20px;
  padding: 10px 18px;
  border: none;
  border-radius: var(--radius);
  background: var(--main-color);
  color: white;
  cursor: pointer;
  font-size: 15px;
  transition: var(--transition);
}
button:hover {
  background: var(--main-color-hover);
  transform: translateY(-1px);
}
.item-row {
  display: flex;
  gap: 10px;
  margin-top: 8px;
  align-items: center;
}
.item-row input {
  flex: 1;
}
.item-row button {
  background: #bbb;
  color: white;
  font-weight: bold;
  padding: 8px 12px;
  border-radius: var(--radius);
}
.item-row button:hover {
  background: #999;
}
#msg {
  text-align: center;
  margin-top: 15px;
  font-weight: 500;
}
a {
  display: inline-block;
  margin-top: 20px;
  text-decoration: none;
  color: var(--main-color);
  transition: var(--transition);
}
a:hover {
  color: var(--main-color-hover);
}
footer {
  text-align: center;
  padding: 20px 10px;
  color: #555;
  font-size: 14px;
  background: white;
  border-top: 1px solid #eee;
  margin-top: 40px;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
</head>
<body>
<header>
  <h1>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h1>
</header>

<div class="container">
  <form id="orderForm">
    <h2>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
    <label>ID –∑–∞–∫–∞–∑–∞:</label>
    <input type="text" id="order_uid" required>

    <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ</h3>
    <label>–ò–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è:</label>
    <input type="text" id="delivery_name" required>
    <label>–¢–µ–ª–µ—Ñ–æ–Ω:</label>
    <input type="text" id="delivery_phone">
    <label>–ì–æ—Ä–æ–¥:</label>
    <input type="text" id="delivery_city" required>
    <label>–ê–¥—Ä–µ—Å:</label>
    <input type="text" id="delivery_address">

    <h3>–¢–æ–≤–∞—Ä—ã</h3>
    <div id="itemsContainer"></div>
    <button type="button" id="addItemBtn">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>

    <h3>–û–ø–ª–∞—Ç–∞</h3>
    <label>–°—É–º–º–∞ (‚ÇΩ):</label>
    <input type="number" id="payment_amount" min="0" required readonly>

    <button type="submit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </form>

  <p id="msg"></p>
  <a href="/">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –∑–∞–∫–∞–∑–æ–≤</a>
</div>

<footer>
  &copy; 2025 –°–µ—Ä–≤–∏—Å –∑–∞–∫–∞–∑–æ–≤. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
</footer>

<script>
const container = document.getElementById("itemsContainer");
const addItemBtn = document.getElementById("addItemBtn");
const amountField = document.getElementById("payment_amount");

function updateTotal() {
  const prices = Array.from(document.querySelectorAll(".item-price")).map(inp => parseFloat(inp.value) || 0);
  const sum = prices.reduce((a, b) => a + b, 0);
  amountField.value = sum;
}

function addItemRow(name = "", price = "") {
  const row = document.createElement("div");
  row.className = "item-row";
  row.innerHTML = `
    <input type="text" class="item-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" value="${name}">
    <input type="number" class="item-price" placeholder="–¶–µ–Ω–∞ (‚ÇΩ)" value="${price}">
    <button type="button" class="removeItem">‚úñ</button>
  `;
  const priceInput = row.querySelector(".item-price");
  priceInput.addEventListener("input", updateTotal);
  row.querySelector(".removeItem").onclick = () => {
    row.remove();
    updateTotal();
  };
  container.appendChild(row);
  updateTotal();
}

// –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
addItemRow();

addItemBtn.onclick = () => addItemRow();

document.getElementById("orderForm").onsubmit = async (e) => {
  e.preventDefault();

  const items = Array.from(document.querySelectorAll(".item-row")).map((row, i) => {
    const name = row.querySelector(".item-name").value.trim();
    const price = parseInt(row.querySelector(".item-price").value) || 0;
    return {
      chrt_id: i + 1,
      track_number: "UI",
      price: price,
      rid: "RID" + i,
      name: name,
      sale: 0,
      size: "N/A",
      total_price: price,
      nm_id: i + 1,
      brand: "Demo",
      status: 200
    };
  });

  const order = {
    order_uid: document.getElementById("order_uid").value.trim(),
    track_number: "UI" + Math.floor(Math.random() * 100000),
    entry: "UI",
    delivery: {
      name: document.getElementById("delivery_name").value.trim(),
      phone: document.getElementById("delivery_phone").value.trim(),
      city: document.getElementById("delivery_city").value.trim(),
      address: document.getElementById("delivery_address").value.trim(),
      region: "",
      zip: "",
      email: ""
    },
    payment: {
      amount: parseInt(amountField.value) || 0,
      currency: "RUB",
      provider: "UI",
      payment_dt: Date.now(),
      bank: "",
      delivery_cost: 0,
      goods_total: 0,
      custom_fee: 0
    },
    items: items,
    locale: "ru",
    customer_id: "ui",
    date_created: new Date().toISOString(),
    delivery_service: "ui",
    shardkey: "1",
    sm_id: 1,
    oof_shard: "1"
  };

  const res = await fetch("/api/orders", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(order)
  });

  if (res.ok) {
    document.getElementById("msg").innerText = "‚úÖ –ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!";
    document.getElementById("orderForm").reset();
    container.innerHTML = "";
    addItemRow();
  } else {
    const t = await res.text();
    document.getElementById("msg").innerText = "–û—à–∏–±–∫–∞: " + t;
  }
};
</script>
</body>
</html>
